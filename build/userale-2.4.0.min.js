/**
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * @preserved
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).userale={})}(this,(function(e){"use strict";var t="2.4.0";let n=null,o=null;function r(){null===n&&(n=s("userAlesessionId","session_"+String(Date.now()))),null===o&&(o=s("userAleHttpSessionId",function(){const e=new Uint8Array(16);return window.crypto.getRandomValues(e),Array.from(e,(e=>e.toString(16).padStart(2,"0"))).join("")}()));const e=document.currentScript||function(){const e=document.getElementsByTagName("script");return e[e.length-1]}(),t=e?e.getAttribute.bind(e):function(){return null},r=t("data-headers");return{authHeader:t("data-auth")||null,autostart:"false"!==t("data-autostart"),browserSessionId:null,custIndex:t("data-index")||null,headers:r?JSON.parse(r):null,httpSessionId:o,logCountThreshold:+(t("data-threshold")||5),logDetails:"true"===t("data-log-details"),resolution:+(t("data-resolution")||500),sessionId:t("data-session")||n,time:i(document.createEvent("CustomEvent")),toolName:t("data-tool")||null,toolVersion:t("data-version")||null,transmitInterval:+(t("data-interval")||5e3),url:t("data-url")||"http://localhost:8000",useraleVersion:t("data-userale-version")||null,userFromParams:t("data-user-from-params")||null,userId:t("data-user")||null}}function s(e,t){return null===window.sessionStorage.getItem(e)?(window.sessionStorage.setItem(e,JSON.stringify(t)),t):JSON.parse(window.sessionStorage.getItem(e)||"")}function i(e){let t;if(e.timeStamp&&e.timeStamp>0){const n=Date.now()-e.timeStamp;if(n<0)t=function(){return e.timeStamp/1e3};else if(n>e.timeStamp){const e=performance.timeOrigin;t=function(t){return t+e}}else t=function(e){return e}}else t=function(){return Date.now()};return t}class a{constructor(){this.autostart=!1,this.authHeader=null,this.browserSessionId=null,this.custIndex=null,this.headers=null,this.httpSessionId=null,this.logCountThreshold=0,this.logDetails=!1,this.on=!1,this.resolution=0,this.sessionId=null,this.time=()=>Date.now(),this.toolName=null,this.toolVersion=null,this.transmitInterval=0,this.url="",this.userFromParams=null,this.useraleVersion=null,this.userId=null,this.version=null,this.websocketsEnabled=!1,null===a.instance&&this.initialize()}static getInstance(){return null===a.instance&&(a.instance=new a),a.instance}initialize(){const e=r();this.update(e)}reset(){this.initialize()}update(e){Object.keys(e).forEach((t=>{if("userFromParams"===t){const n=e[t],o=n?a.getUserIdFromParams(n):null;o&&(this.userId=o)}const n=e.userFromParams;if("userId"===t&&null===e[t]&&n)return;const o=e[t];void 0!==o&&(this[t]=o)}))}static getUserIdFromParams(e){const t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),n=window.location.href.match(t);return n&&n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):null}}a.instance=null;var l=function(e,t,n){if(n||2===arguments.length)for(var o,r=0,s=t.length;r<s;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},u=function(e,t,n){this.name=e,this.version=t,this.os=n,this.type="browser"},c=function(e){this.version=e,this.type="node",this.name="node",this.os=process.platform},d=function(e,t,n,o){this.name=e,this.version=t,this.os=n,this.bot=o,this.type="bot-device"},f=function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},h=function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},m=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,p=3,w=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],g=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];const b="undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new h:"undefined"!=typeof navigator?function(e){var t=function(e){return""!==e&&w.reduce((function(t,n){var o=n[0],r=n[1];if(t)return t;var s=r.exec(e);return!!s&&[o,s]}),!1)}(e);if(!t)return null;var n=t[0],o=t[1];if("searchbot"===n)return new f;var r=o[1]&&o[1].split(".").join("_").split("_").slice(0,3);r?r.length<p&&(r=l(l([],r,!0),function(e){for(var t=[],n=0;n<e;n++)t.push("0");return t}(p-r.length),!0)):r=[];var s=r.join("."),i=function(e){for(var t=0,n=g.length;t<n;t++){var o=g[t],r=o[0];if(o[1].exec(e))return r}return null}(e),a=m.exec(e);return a&&a[1]?new d(n,s,i,a[1]):new u(n,s,i)}(navigator.userAgent):"undefined"!=typeof process&&process.version?new c(process.version.slice(1)):null;let y,S,v,I,k,O,E,T;const W=null;let N,x,P,A,M={};function C(e,t){if(!S.on)return!1;let n=null;t&&(n=t(e));const o=(r=e.timeStamp&&e.timeStamp>0?S.time(e.timeStamp):Date.now(),{milli:Math.floor(r),micro:Number((r%1).toFixed(3))});var r;let s={target:e.target?B(e.target):null,path:H(e),pageUrl:window.location.href,pageTitle:document.title,pageReferrer:document.referrer,browser:L(),clientTime:o.milli,microTime:o.micro,location:j(e),scrnRes:D(),type:e.type,logType:"raw",userAction:!0,details:n,userId:S.userId,toolVersion:S.toolVersion,toolName:S.toolName,useraleVersion:S.useraleVersion,sessionId:S.sessionId,httpSessionId:S.httpSessionId,browserSessionId:S.browserSessionId,attributes:R(e),style:$(e)};for(const t of Object.values(M))if("function"==typeof t&&(s=t(s,e),!s))return!1;return y.push(s),!0}function V(e,t,n){if(!S.on)return!1;let o=null;if(0===t.length){o=t()}const r={pageUrl:window.location.href,pageTitle:document.title,pageReferrer:document.referrer,browser:L(),clientTime:Date.now(),scrnRes:D(),logType:"custom",userAction:n,details:o,userId:S.userId,toolVersion:S.toolVersion,toolName:S.toolName,useraleVersion:S.useraleVersion,sessionId:S.sessionId,httpSessionId:S.httpSessionId,browserSessionId:S.browserSessionId};let s=Object.assign(r,e);for(const e of Object.values(M))if("function"==typeof e&&(s=e(s,null),!s))return!1;return y.push(s),!0}function j(e){return e instanceof MouseEvent?null!=e.pageX?{x:e.pageX,y:e.pageY}:null!=e.clientX?{x:document.documentElement.scrollLeft+e.clientX,y:document.documentElement.scrollTop+e.clientY}:void 0:{x:null,y:null}}function D(){return{width:window.innerWidth,height:window.innerHeight}}function B(e){if(e instanceof HTMLElement||e instanceof Element){if(e.localName)return e.localName+(e.id?"#"+e.id:"")+(e.className?"."+e.className:"");if(e.nodeName)return e.nodeName+(e.id?"#"+e.id:"")+(e.className?"."+e.className:"")}else{if(e instanceof Document)return"#document";if(e===globalThis)return"Window"}return"Unknown"}function H(e){return function(e){let t,n=0;const o=[];for(;t=e[n];)o.push(B(t)),++n,t=e[n];return o}(e.composedPath())}function L(){return{browser:b?b.name:"",version:b?b.version:""}}function R(e){const t={},n=["style"];if(e.target&&e.target instanceof Element)for(const o of e.target.attributes){if(n.includes(o.name))continue;let e=o.value;try{e=JSON.parse(e)}catch(e){}t[o.name]=e}return t}function $(e){const t={};if(e.target&&e.target instanceof HTMLElement){const n=e.target.style;for(let e=0;e<n.length;e++){const o=n[e];t[o]=n.getPropertyValue(o)}}return t}const K=["click","focus","blur","input","change","mouseover","submit"],F=["load","blur","focus"];function _(e){return{clicks:e.detail,ctrl:e.ctrlKey,alt:e.altKey,shift:e.shiftKey,meta:e.metaKey}}function U(e){return{key:e.key,code:e.code,ctrl:e.ctrlKey,alt:e.altKey,shift:e.shiftKey,meta:e.metaKey}}function X(e){return{value:e.target.value}}function z(e){return{x:e.deltaX,y:e.deltaY,z:e.deltaZ}}function J(){return{x:window.scrollX,y:window.scrollY}}function Y(){return{width:window.outerWidth,height:window.outerHeight}}function q(e){try{return function(e){N={click:_,dblclick:_,mousedown:_,mouseup:_,focus:null,blur:null,input:e.logDetails?U:null,change:e.logDetails?X:null,dragstart:null,dragend:null,drag:null,drop:null,keydown:e.logDetails?U:null,mouseover:null},x={},P={wheel:z,scroll:J,resize:Y},A={submit:null}}(e),Object.keys(N).forEach((function(e){document.addEventListener(e,(function(t){C(t,N[e])}),!0)})),K.forEach((function(e){document.addEventListener(e,(function(e){!function(e){try{const t=e.target?B(e.target):null,n=H(e),o=e.type,r=Math.floor(e.timeStamp&&e.timeStamp>0?S.time(e.timeStamp):Date.now());if(null==v&&(v=t,I=o,k=n,O=r,E=0),(v!==t||I!==o)&&O){T={target:v,path:k,pageUrl:window.location.href,pageTitle:document.title,pageReferrer:document.referrer,browser:L(),count:E,duration:r-O,startTime:O,endTime:r,type:I,logType:"interval",targetChange:v!==t,typeChange:I!==o,userAction:!1,userId:S.userId,toolVersion:S.toolVersion,toolName:S.toolName,useraleVersion:S.useraleVersion,sessionId:S.sessionId,httpSessionId:S.httpSessionId,browserSessionId:S.browserSessionId},"function"==typeof W&&W(T);for(const e of Object.values(M))if("function"==typeof e&&(T=e(T,null),!T))return!1;T&&y.push(T),v=t,I=o,k=n,O=r,E=0}return v==t&&I==o&&E&&(E+=1),!0}catch(e){return!1}}(e)}),!0)})),Object.keys(P).forEach((function(t){x[t]=!0,window.addEventListener(t,(function(n){x[t]&&(x[t]=!1,C(n,P[t]),setTimeout((function(){x[t]=!0}),e.resolution))}),!0)})),Object.keys(A).forEach((function(e){document.addEventListener(e,(function(t){C(t,N[e])}),!0)})),F.forEach((function(e){window.addEventListener(e,(function(e){C(e,(function(){return{window:!0}}))}),!0)})),!0}catch(e){return!1}}let G,Q=null;function Z(t,n){G&&clearInterval(G),G=function(t,n){return setInterval((function(){n.on&&t.length>=n.logCountThreshold&&(!function(t,n,o){const r=JSON.stringify(t);if(n.websocketsEnabled)e.wsock.send(r);else{const e=new XMLHttpRequest;e.open("POST",n.url),function(e){if(Q)try{e.authHeader=Q()}catch(e){console.error(`Error encountered while setting the auth header: ${e}`)}}(n),n.authHeader&&e.setRequestHeader("Authorization","function"==typeof n.authHeader?n.authHeader():n.authHeader),e.setRequestHeader("Content-type","application/json;charset=UTF-8"),n.headers&&Object.entries(n.headers).forEach((([t,n])=>{e.setRequestHeader(t,n)})),e.onreadystatechange=function(){4===e.readyState&&e.status},e.send(r)}}(t.slice(0),n),t.splice(0))}),n.transmitInterval)}(t,n),ee(t,n)}function ee(t,n){window.addEventListener("pagehide",(function(){if(n.on&&t.length>0){if(n.websocketsEnabled){const n=JSON.stringify(t);e.wsock.send(n)}else{const e=new Headers;e.set("Content-Type","applicaiton/json;charset=UTF-8"),n.authHeader&&e.set("Authorization",n.authHeader.toString()),fetch(n.url,{keepalive:!0,method:"POST",headers:e,body:JSON.stringify(t)}).catch((e=>{console.error(e)}))}t.splice(0)}}))}const te=a.getInstance(),ne=[],oe=Date.now();let re;window.onload=function(){re=Date.now()},e.started=!1,e.wsock=void 0,te.update({useraleVersion:t}),y=ne,S=te,M={},v=null,I=null,k=null,O=null,E=0,T=null,function(t){e.wsock=new WebSocket(t.url.replace("http://","ws://")),e.wsock.onerror=()=>{console.log("no websockets detected")},e.wsock.onopen=()=>{console.log("connection established with websockets"),t.websocketsEnabled=!0},e.wsock.onclose=()=>{ee(ne,t)}}(te),te.autostart&&function t(n){e.started||setTimeout((function(){const o=document.readyState;!n.autostart||"interactive"!==o&&"complete"!==o?t(n):(q(n),Z(ne,n),e.started=n.on=!0,V({type:"load",details:{pageLoadTime:re-oe}},(()=>({})),!1))}),100)}(te);const se=t;e.addCallbacks=function(...e){return e.forEach((e=>{let t={};t=Object.keys(e).reduce(((t,n)=>(t[n]=Object.getOwnPropertyDescriptor(e,n),t)),t),Object.getOwnPropertySymbols(e).forEach((n=>{const o=Object.getOwnPropertyDescriptor(e,n);(null==o?void 0:o.enumerable)&&(t[n]=o)})),Object.defineProperties(M,t)})),M},e.buildPath=H,e.details=function(e,t){return{click:_,dblclick:_,mousedown:_,mouseup:_,focus:null,blur:null,load:null,input:e.logDetails?U:null,change:e.logDetails?X:null,dragstart:null,dragend:null,drag:null,drop:null,keydown:e.logDetails?U:null,mouseover:null,wheel:z,scroll:J,resize:Y,submit:null}[t]},e.getSelector=B,e.log=function(e){return!!e&&(ne.push(e),!0)},e.options=function(e){return e&&te.update(e),te},e.packageCustomLog=V,e.packageLog=C,e.registerAuthCallback=function(e){try{return function(e){if("function"!=typeof e)throw new Error("Userale auth callback must be a function");const t=e();if("string"!=typeof t)throw new Error("Userale auth callback must return a string")}(e),Q=e,!0}catch(e){return!1}},e.removeCallbacks=function(e){e.forEach((e=>{Object.prototype.hasOwnProperty.call(M,e)&&delete M[e]}))},e.start=function(){e.started&&!1!==te.autostart||(e.started=te.on=!0,te.update({autostart:!0}))},e.stop=function(){e.started=te.on=!1,te.update({autostart:!1})},e.version=se}));
